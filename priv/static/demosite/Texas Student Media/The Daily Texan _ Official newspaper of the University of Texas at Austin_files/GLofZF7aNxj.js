if (self.CavalryLogger) { CavalryLogger.start_js(["EQVO4"]); }

__d("BanzaiOld",["BanzaiAdapter","BanzaiStreamPayloads","CurrentUser","ErrorUtils","ExecutionEnvironment","FBJSON","FBLogger","NavigationMetrics","SetIdleTimeoutAcrossTransitions","TimeSlice","Visibility","WebStorage","emptyFunction","gkx","isInIframe","lowerFacebookDomain","onAfterDisplay","pageID","WebStorageMutex"],(function(a,b,c,d,e,f){__p&&__p();var g=b("BanzaiAdapter").adapter,h=b("isInIframe")(),i="bz:",j="ods:banzai",k="send_via_beacon_failure",l=0,m=1,n=2,o,p,q=[],r=null,s=[];function t(a){return a[2]>=Date.now()-(g.config.EXPIRY||b("BanzaiAdapter").EXPIRY)}function u(a,b){a.__meta.status=l,a[3]=(a[3]||0)+1,!a.__meta.retry&&b>=400&&b<600&&q.push(a)}function v(a,c,d,e){a=[a,c,d,0];a.__meta={retry:e===!0,pageID:b("pageID"),userID:b("CurrentUser").getID(),status:l};return a}function w(){__p&&__p();var a=[];s.forEach(function(b){var c=b.cb();c.forEach(function(c){var d=b.route;if(d){d=v(d,c,Date.now());d.__meta.onSuccess=b.onSuccess;d.__meta.onFailure=b.onFailure;a.push(d)}})});s=[];var c=[],d=[];B(c,d,!0,a);if(c.length>0){c[0].send_method="beacon";c.map(g.prepWadForTransit);c=new Blob([g.addRequestAuthData(g.prepForTransit(c))],{type:"application/x-www-form-urlencoded"});c=navigator.sendBeacon(b("BanzaiAdapter").adapter.endpoint,c);c?d.forEach(function(b){return a.__meta&&b.__meta.onSuccess&&b.__meta.onSuccess()}):d.forEach(function(b){return a.__meta&&b.__meta.onFailure&&b.__meta.onFailure()})}}function x(a){__p&&__p();var c=Date.now()+a;if(!p||c<p){p=c;b("SetIdleTimeoutAcrossTransitions").clear(o);c=function(){o=b("SetIdleTimeoutAcrossTransitions").start(y,a)};b("gkx")("AT6Afdq0Tt2jEesGOMGnSRKoZIl2eQfQBS7ISXiYFG3RHN4ykkPiZeyWuKALtD0ObEVGeeZuAFKdYpfxlBzUUPkd")?b("onAfterDisplay")(c):c();return!0}return!1}var y=b("TimeSlice").guard(function(){z(null,null)},"Banzai.send",{propagationType:b("TimeSlice").PropagationType.ORPHAN});function z(a,c){__p&&__p();p=null;x(b("BanzaiAdapter").BASIC.delay);if(!g.readyToSend()){c&&c();return}g.inform(b("BanzaiAdapter").SEND);var d=[],e=[];q=B(d,e,!0,q);if(d.length<=0){g.inform(b("BanzaiAdapter").OK);a&&a();return}d[0].trigger=r;r=null;d[0].send_method="ajax";d.map(g.prepWadForTransit);g.send(d,function(){e.forEach(function(a){a.__meta.status=n,a.__meta.callback&&a.__meta.callback()}),a&&a()},function(a){e.forEach(function(b){u(b,a)}),c&&c()})}function A(){__p&&__p();if(!(navigator&&navigator.sendBeacon&&g.isOkToSendViaBeacon()))return;var a=[],c=[];q=B(a,c,!1,q);if(a.length<=0)return;a[0].send_method="beacon";a.map(g.prepWadForTransit);a=new Blob([g.addRequestAuthData(g.prepForTransit(a))],{type:"application/x-www-form-urlencoded"});a=navigator.sendBeacon(b("BanzaiAdapter").adapter.endpoint,a);if(!a){c.forEach(function(a){q.push(a)});q.push(v(j,(a={},a[k]=[1],a),Date.now()))}}function B(a,b,c,d){__p&&__p();var e={};return d.filter(function(d){__p&&__p();var f=d.__meta;if(f.status>=n||!t(d))return!1;if(f.status>=m)return!0;var g=f.compress!=null?f.compress:!0,h=f.pageID+f.userID+(g?"compress":""),i=e[h];i||(i={user:f.userID,page_id:f.pageID,posts:[],snappy:g},e[h]=i,a.push(i));f.status=m;i.posts.push(d);b.push(d);return c&&f.retry})}var C,D,E=!1;function F(){E||(E=!0,D=b("WebStorage").getLocalStorage());return D}function G(){__p&&__p();C||(!h?C={store:function(){var a=F();if(!a||q.length<=0)return;var c=q.map(function(a){return[a[0],a[1],a[2],a[3]||0,a.__meta]});q=[];a.setItem(i+b("pageID")+"."+Date.now(),b("FBJSON").stringify(c))},restore:function(){__p&&__p();var a=F();if(!a)return;var c=b("WebStorageMutex");new c("banzai").lock(function(c){__p&&__p();var d=[];for(var f=0;f<a.length;f++){var g=a.key(f);g.indexOf(i)===0&&g.indexOf("bz:__")!==0&&d.push(g)}d.forEach(function(c){__p&&__p();var d=a.getItem(c);a.removeItem(c);if(!d)return;c=b("FBJSON").parse(d,e.id);c.forEach(function(a){if(!a)return;var c=a.__meta=a.pop(),d=t(a);if(!d)return;d=b("CurrentUser").getID();(c.userID===d||d==="0")&&(c.status=l,q.push(a))})});c.unlock()})}}:C={store:b("emptyFunction"),restore:b("emptyFunction")})}b("BanzaiAdapter").SEND="Banzai:SEND";b("BanzaiAdapter").OK="Banzai:OK";b("BanzaiAdapter").ERROR="Banzai:ERROR";b("BanzaiAdapter").SHUTDOWN="Banzai:SHUTDOWN";b("BanzaiAdapter").VITAL_WAIT=1e3;b("BanzaiAdapter").BASIC_WAIT=6e4;b("BanzaiAdapter").EXPIRY=30*6e4;b("BanzaiAdapter").VITAL={delay:g.config.MIN_WAIT||b("BanzaiAdapter").VITAL_WAIT};b("BanzaiAdapter").BASIC={delay:g.config.MAX_WAIT||b("BanzaiAdapter").BASIC_WAIT};b("BanzaiAdapter").isEnabled=function(a){return g.config.gks&&g.config.gks[a]};b("BanzaiAdapter").post=function(c,d,e){__p&&__p();c||b("FBLogger")("banzai").mustfix("Banzai.post called without specifying a route");e=e||{};var f=e.retry;if(g.config.disabled)return;if(!b("ExecutionEnvironment").canUseDOM)return;var i=g.config.blacklist;if(i&&(i.indexOf&&(typeof i.indexOf==="function"&&i.indexOf(c)!=-1)))return;if(h&&b("lowerFacebookDomain").isValidDocumentDomain()){var j;void 0;try{j=a.top.require("Banzai")}catch(a){j=null}if(j){j.post.apply(j,arguments);return}}var k=v(c,d,Date.now(),f);e.callback&&(k.__meta.callback=e.callback);e.compress!=null&&(k.__meta.compress=e.compress);var l=e.delay;l==null&&(l=b("BanzaiAdapter").BASIC_WAIT);if(e.signal){k.__meta.status=m;var o=[{user:b("CurrentUser").getID(),page_id:b("pageID"),posts:[k],trigger:c}];g.send(o,function(){k.__meta.status=n,k.__meta.callback&&k.__meta.callback()},function(a){u(k,a)},!0);if(!f)return}q.push(k);(x(l)||!r)&&(r=c)};b("BanzaiAdapter").registerToSendWithBeacon=function(a,c,d,e){if(!(navigator&&navigator.sendBeacon&&g.isOkToSendViaBeacon()))return!1;if(!a){b("FBLogger")("banzai").mustfix("Banzai.registerToSendWithBeacon called without specifying a route");return!1}s.push({cb:c,route:a,onSuccess:d,onFailure:e});return!0};b("BanzaiAdapter").flush=function(a,c){b("SetIdleTimeoutAcrossTransitions").clear(o),o=0,z(a,c)};b("BanzaiAdapter").subscribe=g.subscribe;b("BanzaiAdapter").canUseNavigatorBeacon=function(){return navigator&&navigator.sendBeacon&&g.isOkToSendViaBeacon()};b("BanzaiAdapter")._schedule=x;b("BanzaiAdapter")._store=function(a){G(),b("ErrorUtils").applyWithGuard(C.store,C)};b("BanzaiAdapter")._restore=function(a){G(),b("ErrorUtils").applyWithGuard(C.restore,C),x(g.config.RESTORE_WAIT||b("BanzaiAdapter").VITAL_WAIT)};b("BanzaiAdapter")._unload=function(){b("BanzaiStreamPayloads").unload(b("BanzaiAdapter").post),navigator&&navigator.sendBeacon&&g.isOkToSendViaBeacon()&&w(),g.cleanup(),g.inform(b("BanzaiAdapter").SHUTDOWN),b("BanzaiAdapter").isEnabled("beacon_hailmary")&&q.length>0&&A(),q.length>0&&(G(),b("ErrorUtils").applyWithGuard(C.store,C))};b("BanzaiAdapter")._testState=function(){return{postBuffer:q,triggerRoute:r}};(b("BanzaiAdapter")._initialize=function(){b("ExecutionEnvironment").canUseDOM&&(b("BanzaiAdapter").isEnabled("beacon_hailmary")&&b("Visibility").isSupported()?b("Visibility").addListener(b("Visibility").HIDDEN,function(){q.length>0&&A(),q.length>0&&(G(),b("ErrorUtils").applyWithGuard(C.store,C))}):g.setHooks(),g.setUnloadHook(),b("NavigationMetrics").addListener(b("NavigationMetrics").Events.NAVIGATION_DONE,function(a,c){if(c.pageType!=="normal")return;b("BanzaiAdapter")._restore();b("NavigationMetrics").removeCurrentListener()}))})();e.exports=b("BanzaiAdapter")}),null);